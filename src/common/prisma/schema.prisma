generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Conference {
  AMERICAN
  ACC
  BIG_12
  BIG_TEN
  CONFERENCE_USA
  FBS_INDEPENDENTS
  MID_AMERICAN
  MOUNTAIN_WEST
  PAC_12
  SEC
  SUN_BELT
  FCS_CONFERENCE
}

enum GameStatus {
  SCHEDULED
  FINAL
}

enum GameType {
  REGULAR_SEASON
  CONFERENCE_CHAMPIONSHIP
  BOWL
  PLAYOFF_FIRST_ROUND
  QUARTERFINAL
  SEMIFINAL
  NATIONAL_CHAMPIONSHIP
}

enum ParticipantRole {
  AWAY
  HOME
}

enum StreakType {
  WIN
  LOSS
}

model Game {
  id   Int    @id @default(autoincrement())
  slug String @unique

  name             String?
  date             DateTime
  isTimeTBD        Boolean    @map("is_time_tbd")
  status           GameStatus @default(SCHEDULED)
  weekNumber       Int?       @map("week_number")
  gameType         GameType   @map("game_type")
  isConferenceGame Boolean    @map("is_conference_game")
  isNeutralSite    Boolean    @map("is_neutral_site")
  endedInOvertime  Boolean    @default(false) @map("ended_in_overtime")
  overtimes        Int?

  seasonId  Int @map("season_id")
  stadiumId Int @map("stadium_id")

  season           Season            @relation(fields: [seasonId], references: [id])
  stadium          Stadium           @relation(fields: [stadiumId], references: [id])
  gameParticipants GameParticipant[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([seasonId, date, stadiumId])
  @@map("games")
}

model Season {
  id   Int    @id @default(autoincrement())
  slug String @unique

  name               String   @unique
  startDate          DateTime @map("start_date")
  endDate            DateTime @map("end_date")
  isCurrentSeason    Boolean  @default(false) @map("is_current_season")
  isCfpRankAvailable Boolean  @default(false) @map("is_cfp_rank_available")

  games           Game[]
  teamSeasonStats TeamSeasonStat[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("seasons")
}

model Stadium {
  id   Int    @id @default(autoincrement())
  slug String @unique

  name  String
  city  String
  state String

  teams Team[]
  games Game[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([name, city, state])
  @@map("stadiums")
}

model Team {
  id   Int    @id @default(autoincrement())
  slug String @unique

  displayName      String     @unique @map("display_name")
  shortDisplayName String     @unique @map("short_display_name")
  abbreviation     String     @unique
  mascot           String
  conference       Conference

  stadiumId Int? @map("stadium_id")

  stadium          Stadium?          @relation(fields: [stadiumId], references: [id])
  logo             Logo?
  gameParticipants GameParticipant[]
  teamSeasonStats  TeamSeasonStat[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("teams")
}

model GameParticipant {
  id Int @id @default(autoincrement())

  role     ParticipantRole
  score    Int?
  isWinner Boolean?        @map("is_winner")

  gameId Int @map("game_id")
  teamId Int @map("team_id")

  game Game @relation(fields: [gameId], references: [id])
  team Team @relation(fields: [teamId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([gameId, teamId])
  @@unique([gameId, role])
  @@map("game_participants")
}

model Logo {
  id Int @id @default(autoincrement())

  url     String @unique
  darkUrl String @unique @map("dark_url")
  width   Int    @default(500)
  height  Int    @default(500)
  alt     String

  teamId Int @unique @map("team_id")

  team Team @relation(fields: [teamId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("logos")
}

model TeamSeasonStat {
  id Int @id @default(autoincrement())

  wins             Int @default(0)
  losses           Int @default(0)
  conferenceWins   Int @default(0) @map("conference_wins")
  conferenceLosses Int @default(0) @map("conference_losses")
  homeWins         Int @default(0) @map("home_wins")
  homeLosses       Int @default(0) @map("home_losses")
  awayWins         Int @default(0) @map("away_wins")
  awayLosses       Int @default(0) @map("away_losses")
  neutralWins      Int @default(0) @map("neutral_wins")
  neutralLosses    Int @default(0) @map("neutral_losses")

  streak     Int        @default(0)
  streakType StreakType @default(WIN) @map("streak_type")

  conferenceRank Int? @map("conference_rank")
  apRank         Int? @map("ap_rank")
  cfpRank        Int? @map("cfp_rank")

  teamId   Int @map("team_id")
  seasonId Int @map("season_id")

  team   Team   @relation(fields: [teamId], references: [id])
  season Season @relation(fields: [seasonId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([teamId, seasonId])
  @@map("team_season_stats")
}
